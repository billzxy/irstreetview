{"version":3,"sources":["assets/viewPano/resource sync /^/.*$","assets/pano_inside-2-medium.png","assets/rotating.png","assets/viewPano/resource/pano-20190724143458-mx.png","assets/viewPano/resource/pano-20190724143833-mx.png","assets/viewPano/resource/pano-20190724145944-mx.png","assets/viewPano/resource/pano-20190724150711-mx.png","assets/viewPano/resource/pano-20190724151238-mx.png","assets/viewPano/resource/pano-20190724151553-mx.png","assets/viewPano/resource/pano-20190925110216-mx.png","assets/viewPano/resource/pano-20190925110449-mx.png","assets/viewPano/resource/pano-20190925110659-mx.png","assets/viewPano/resource/pano-20190925111017-mx.png","assets/viewPano/resource/pano-20190925111251-mx.png","assets/viewPano/resource/pano-20190925111418-mx.png","assets/viewPano/resource/pano-20190925111628-mx.png","assets/viewPano/resource/pano-20190925111907-mx.png","assets/viewPano/resource/pano-20190925112004-mx.png","assets/viewPano/resource/pano-20190925112226-mx.png","assets/viewPano/resource/pano-20190925112242-mx.png","assets/viewPano/resource/pano-20190925112410-mx.png","assets/viewPano/resource/pano-20190925112418-mx.png","assets/viewPano/resource/pano-20190925112754-mx.png","assets/viewPano/resource/pano-20190925112757-mx.png","assets/viewPano/resource/pano-20190925112929-mx.png","assets/viewPano/resource/pano-20190925112944-mx.png","assets/viewPano/resource/pano-20190925113109-mx.png","assets/viewPano/resource/pano-20190925113249-mx.png","assets/viewPano/resource/pano-20190925113346-mx.png","components/layout.tsx","api/index.ts","maps.tsx","minimap.tsx","geo.tsx","shapes.tsx","components/spinner.tsx","pano.tsx","App.tsx","index.tsx"],"names":["map","./pano-20190724143458-mx.png","./pano-20190724143833-mx.png","./pano-20190724145944-mx.png","./pano-20190724150711-mx.png","./pano-20190724151238-mx.png","./pano-20190724151553-mx.png","./pano-20190925110216-mx.png","./pano-20190925110449-mx.png","./pano-20190925110659-mx.png","./pano-20190925111017-mx.png","./pano-20190925111251-mx.png","./pano-20190925111418-mx.png","./pano-20190925111628-mx.png","./pano-20190925111907-mx.png","./pano-20190925112004-mx.png","./pano-20190925112226-mx.png","./pano-20190925112242-mx.png","./pano-20190925112410-mx.png","./pano-20190925112418-mx.png","./pano-20190925112754-mx.png","./pano-20190925112757-mx.png","./pano-20190925112929-mx.png","./pano-20190925112944-mx.png","./pano-20190925113109-mx.png","./pano-20190925113249-mx.png","./pano-20190925113346-mx.png","webpackContext","req","id","webpackContextResolve","__webpack_require__","o","e","Error","code","keys","Object","resolve","module","exports","p","Container","styled","div","_templateObject","Header","_templateObject2","Content","_templateObject3","NAV_BAR_HEIGHT","getDataFromJSONArray","data","query","i","length","resultArr","_iteratorNormalCompletion","_didIteratorError","_iteratorError","undefined","_step","_iterator","Symbol","iterator","next","done","param","value","push","err","return","result","_iteratorNormalCompletion2","_didIteratorError2","_iteratorError2","_step2","_iterator2","getNeighbors","nhood","Array","isArray","_iteratorNormalCompletion3","_didIteratorError3","_iteratorError3","_step3","_iterator3","hood","arr","getTwoNeighbors","mockedNeighbors","prototype","apply","type","apis","getPanoFileNameById","Promise","mockedPanos","getPanoCoordById","getAllPanoIdAndCoord","getPanoAllAttrById","getNeighborsById","neighborhood","StyledMap","Map","maps_templateObject","maps_templateObject2","regions","boston","lat","lng","concord","MapContainer","props","_this","classCallCheck","this","possibleConstructorReturn","getPrototypeOf","call","bounds","google","maps","LatLngBounds","state","showComp","_this2","_ref","asyncToGenerator","regenerator_default","a","mark","_callee","wrap","_context","prev","api","then","coordArr","coord","setState","coords","stop","arguments","getAllPanoCoords","extend","LatLng","_this3","setBounds","index","react_default","createElement","google_maps_react_dist","lid","position","onClick","showComponent","gotoPano","key","history","concat","ref","onMapMounted","zoom","center","match","params","region","initialCenter","addMarkers","Component","EnhancedMap","GoogleApiWrapper","apiKey","process","withRouter","maps_Container","minimapElement","minimap_templateObject","minimap_templateObject2","mapHandlerInit","document","getElementsByClassName","addEventListener","preventDefault","style","width","height","minimapZoomIn","minimapZoomOut","MapStore","_class","cameraY","initializerDefineProperty","_descriptor","_descriptor2","_descriptor3","_descriptor4","pmanOffsetY","setPegmanRotationOffsetYFromCameraY","createClass","deg","Math","ceil","PI","floor","applyDecoratedDescriptor","observable","configurable","enumerable","writable","initializer","observer","panoStore","mStore","dotIcon","url","require","size","Size","origin","Point","anchor","pman","mapStore","pegIcon","icon","z","zIndex","Fragment","minimap_StyledMap","onReady","streetViewControl","fullscreenControl","mapTypeControl","rotateControl","addPegman","renderCompass","Minimap","minimap","minimap_Container","Location","calibration","fname","neighborArr","setAllAttr","filename","getNeighborIds","_callee2","_context2","updateCalibration","_ref3","_callee3","camera","_context3","rotation","y","alert","_x","loc","geolib","neighbor","getDistanceTo","getBearingTo","Arrow","mesh","material","geometry","THREE","vertices","faces","color","Rings","spinner_templateObject","_ref$width","_ref2","_ref2$width","_ref3$color","TWEEN","Pano","currLoc","neighbors","panoIdChangeReaction","cylindergeometry","cylindermaterial","cylindermesh","texture","loader","lines","tempcylindergeometry","tempcylindermaterial","tempcylindermesh","threeCamera","threeScene","cone0","cone1","cone2","pinSphereGeometry","pinNeedleGeometry","pin0","pin1","pin2","n0","n1","n2","mouseSelectedArrowMesh","teleportToScene","load","side","scale","add","animateTeleportationTextureFade","_this$currLoc","updateValues","console","error","fadeBegin","at","opacity","crossfade","Tween","to","easing","Easing","Quadratic","InOut","onUpdate","onComplete","fov","updateProjectionMatrix","transparent","remove","dispose","setNeighbors","RenderArrows","start","iter","get","log","cos","bearing","x","sin","visible","isLoading","RenderPano","bind","assertThisInitialized","disableBodyScroll","querySelector","panoId","loadTexture","setCurrLocAndNeighbors","clear","nidArr","nid","nextLoc","addNeighbor","n","set","location","distance","_this4","PanoStore","reaction","_this5","rotBegin","tweenRot","updatePegmanOffset","_this6","_useThree","useThree","gl","scene","canvas","raycaster","setSize","clientWidth","clientHeight","lookAt","cone","conemesh","useRef","conemesh1","conemesh2","compassPlate","current","mouse","arrow","mouseplateG","isDraggin","rcObjects","planegeo","planemat","rcplane","computeBoundingSphere","center1","boundingSphere","v1","Vector3","coneGroup","localToWorld","distanceToArrowInWorldCoord","children","center0","v0","distanceTo","mouseDown","mouseX","startX","rotateScene","deltaX","window","event","clientX","innerWidth","clientY","innerHeight","setFromCamera","intersects","intersectObjects","intersect","copy","point","evt","onMouseMove","path","deltaY","wheelDeltaY","onScroll","targetTouches","pageX","onTouchMove","aspect","animateTransition","camAt","endAt","rotEnd","zVal","xVal","fovValue","zoomEnd","tweenZoom","_callee5","_context6","chain","transitionToScene","_ref5","_callee6","pid","_context7","_this6$currLoc","_x2","compassGroup","triGeo","triGeoArr","setChildrenOpacity","group","opc","computeFaceNormals","testMesh","useRender","update","dist","_i","_arr","min","toConsumableArray","getClosestArrowAndAdjustDirection","userData","onPointerOver","object","onPointerOut","attach","CameraLookNorth","onPointerUp","navigateWithMouse","className","spinner","react_three_fiber_dist","pano_class","pano_descriptor","routes","title","Interface","_Component","renderPano","panoUnmount","inherits","react_router_dom","r","activeClassName","react_router","render","exact","src_pano","component","from","ReactDOM","App_Interface","getElementById"],"mappings":"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","file":"static/js/main.00af6055.chunk.js","sourcesContent":["var map = {\n\t\"./pano-20190724143458-mx.png\": 121,\n\t\"./pano-20190724143833-mx.png\": 122,\n\t\"./pano-20190724145944-mx.png\": 123,\n\t\"./pano-20190724150711-mx.png\": 124,\n\t\"./pano-20190724151238-mx.png\": 125,\n\t\"./pano-20190724151553-mx.png\": 126,\n\t\"./pano-20190925110216-mx.png\": 127,\n\t\"./pano-20190925110449-mx.png\": 128,\n\t\"./pano-20190925110659-mx.png\": 129,\n\t\"./pano-20190925111017-mx.png\": 130,\n\t\"./pano-20190925111251-mx.png\": 131,\n\t\"./pano-20190925111418-mx.png\": 132,\n\t\"./pano-20190925111628-mx.png\": 133,\n\t\"./pano-20190925111907-mx.png\": 134,\n\t\"./pano-20190925112004-mx.png\": 135,\n\t\"./pano-20190925112226-mx.png\": 136,\n\t\"./pano-20190925112242-mx.png\": 137,\n\t\"./pano-20190925112410-mx.png\": 138,\n\t\"./pano-20190925112418-mx.png\": 139,\n\t\"./pano-20190925112754-mx.png\": 140,\n\t\"./pano-20190925112757-mx.png\": 141,\n\t\"./pano-20190925112929-mx.png\": 142,\n\t\"./pano-20190925112944-mx.png\": 143,\n\t\"./pano-20190925113109-mx.png\": 144,\n\t\"./pano-20190925113249-mx.png\": 145,\n\t\"./pano-20190925113346-mx.png\": 146\n};\n\n\nfunction webpackContext(req) {\n\tvar id = webpackContextResolve(req);\n\treturn __webpack_require__(id);\n}\nfunction webpackContextResolve(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t}\n\treturn map[req];\n}\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = 48;","module.exports = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAALCAMAAACecocUAAAACXBIWXMAAAAcAAAAHAAPAbmPAAAAIVBMVEUAAABVnbVRnbVRnbVdpb2l4fpVnb1dqcFVnblVobmFyeFl3ybiAAAAC3RSTlMAtb18tGwapUy9gIWpoGAAAABESURBVHja7f3HAcQwDMMAkFSzvf/A8V2aMgRfENRWAJBG0XITBuXl4tiWc0XEmkyYfrgLGehxxgnVxaWP7/P9Tr/f/h6CtgH6SIBB6wAAAABJRU5ErkJggg==\"","module.exports = __webpack_public_path__ + \"static/media/rotating.4957277e.png\";","module.exports = __webpack_public_path__ + \"static/media/pano-20190724143458-mx.072de3d6.png\";","module.exports = __webpack_public_path__ + \"static/media/pano-20190724143833-mx.0732614b.png\";","module.exports = __webpack_public_path__ + \"static/media/pano-20190724145944-mx.0c7531e1.png\";","module.exports = __webpack_public_path__ + \"static/media/pano-20190724150711-mx.f67813cf.png\";","module.exports = __webpack_public_path__ + \"static/media/pano-20190724151238-mx.3f9e7726.png\";","module.exports = __webpack_public_path__ + \"static/media/pano-20190724151553-mx.c1e8bceb.png\";","module.exports = __webpack_public_path__ + \"static/media/pano-20190925110216-mx.15966b2a.png\";","module.exports = __webpack_public_path__ + \"static/media/pano-20190925110449-mx.5b18415f.png\";","module.exports = __webpack_public_path__ + \"static/media/pano-20190925110659-mx.a9cd19bd.png\";","module.exports = __webpack_public_path__ + \"static/media/pano-20190925111017-mx.d1eacec2.png\";","module.exports = __webpack_public_path__ + \"static/media/pano-20190925111251-mx.3a2748ab.png\";","module.exports = __webpack_public_path__ + \"static/media/pano-20190925111418-mx.80a5715d.png\";","module.exports = __webpack_public_path__ + \"static/media/pano-20190925111628-mx.c890f6ed.png\";","module.exports = __webpack_public_path__ + \"static/media/pano-20190925111907-mx.f5896ac6.png\";","module.exports = __webpack_public_path__ + \"static/media/pano-20190925112004-mx.7f51a340.png\";","module.exports = __webpack_public_path__ + \"static/media/pano-20190925112226-mx.a1e5bd11.png\";","module.exports = __webpack_public_path__ + \"static/media/pano-20190925112242-mx.4589189c.png\";","module.exports = __webpack_public_path__ + \"static/media/pano-20190925112410-mx.5e375cce.png\";","module.exports = __webpack_public_path__ + \"static/media/pano-20190925112418-mx.f8ad88bb.png\";","module.exports = __webpack_public_path__ + \"static/media/pano-20190925112754-mx.e2a0bfca.png\";","module.exports = __webpack_public_path__ + \"static/media/pano-20190925112757-mx.702d7268.png\";","module.exports = __webpack_public_path__ + \"static/media/pano-20190925112929-mx.dad914bf.png\";","module.exports = __webpack_public_path__ + \"static/media/pano-20190925112944-mx.fdd79d67.png\";","module.exports = __webpack_public_path__ + \"static/media/pano-20190925113109-mx.1c1e94e1.png\";","module.exports = __webpack_public_path__ + \"static/media/pano-20190925113249-mx.798912fc.png\";","module.exports = __webpack_public_path__ + \"static/media/pano-20190925113346-mx.0775a445.png\";","import React from \"react\";\r\nimport styled from \"styled-components\";\r\n\r\nexport const NAV_BAR_HEIGHT = 0;\r\nexport const NAV_BAR_PADDING = 2;\r\n\r\nexport const Container = styled.div`\r\n\twidth: 100vw;\r\n\theight: 100vh;\r\n\tdisplay: flex;\r\n\tflex-direction: column;\r\n`;\r\n\r\nexport const Header = styled.div`\r\n\tposition: fixed;\r\n\tz-index: 999;\r\n\ttop: 10px;\r\n\tright: 10px;\r\n\tpadding: 12px;\r\n\theight: 20px;\r\n\tdisplay: flex;\r\n\tjustify-content: flex-start;\r\n\talign-items: center;\r\n\tbackground-color: #f8f8f8;\r\n    box-shadow: 2px 2px gray;\r\n\r\n\t& .ir-nav-item {\r\n\t\tmargin-right: 0.5rem;\r\n\t\tmargin-left: 0.5rem;\r\n\t\ttext-decoration: none;\r\n\t\tcolor: rgba(0, 0, 0, 0.5);\r\n\t}\r\n\r\n\t& .ir-nav-item__active {\r\n\t\tcolor: #000000;\r\n\t}\r\n`;\r\n\r\nexport const Content = styled.div`\r\n\tflex: 1;\r\n\tpadding: 2px;\r\n\tpadding-top: ${NAV_BAR_HEIGHT + 2}px;\r\n`;\r\n","import axios from 'axios'\r\nimport mockedPanos from '../mocks/panos.json'\r\nimport mockedNeighbors from '../mocks/neighbors.json'\r\n\r\n/*\r\nconst hostname = \"localhost\";\r\nconst port = \"8080\";\r\nconst url = 'http://' + hostname + ':' + port + '/api';\r\n\r\nconst api = axios.create({\r\n    baseURL: url,\r\n})\r\n\r\nexport const insertPano = payload => api.post(`/pano`, payload)\r\nexport const getAllPanos = () => api.get(`/panos/all`)\r\nexport const deletePanoById = id => api.delete(`/pano/${id}`)\r\nexport const getPanoById = id => api.get(`/pano/${id}`)\r\n\r\nexport const getPanoCoordById = (id) => api.get(`/pano/coord/${id}`)\r\nexport const getPanoFileNameById = id => api.get(`/pano/fname/${id}`)\r\nexport const getPanoAllAttrById = (id) => api.get(`/pano/allAttr/${id}`)\r\nexport const updateCalibrationById = (id, payload) => api.put(`/pano/cal/${id}`, payload)\r\n*/\r\n\r\nfunction getDataFromJSONArray(data, query, id?){\r\n    if(!id){//case when api resembles to 'getAllBlaBlah'\r\n        for(var i=0; i<data.length; i++){\r\n            var resultArr = [];\r\n            for(let param of query){\r\n                resultArr.push(data[i][param]);\r\n            }\r\n            return resultArr;\r\n        }\r\n    }\r\n    for(var i=0; i<data.length; i++){//case when api resembles \"getBlahBlahById\"\r\n        if(data[i][\"id\"]===id){\r\n            if(query.length===0)//case specific for \"getAllAttrById\"\r\n                return data[i];\r\n            var result = {};\r\n            for(let param of query){\r\n                result[param]=data[i][param];\r\n            }\r\n            return result;\r\n        }\r\n    }\r\n}\r\n\r\nfunction getMatrixNeighbors(){\r\n//used for getting irregular neighbor hood neighbors\r\n}\r\n\r\nfunction getNeighbors(id, nhood){\r\n    if(Array.isArray(nhood)){//in the case of a junction\r\n        var result = [];\r\n        for(let hood of nhood){\r\n            let arr = getTwoNeighbors(id,mockedNeighbors[hood]);\r\n            Array.prototype.push.apply(result, arr);\r\n        }\r\n        return result;\r\n    }else{ //linear or circular\r\n        let arr = getTwoNeighbors(id, mockedNeighbors[nhood]);\r\n        return arr;\r\n    }\r\n}\r\n\r\nfunction getTwoNeighbors(id, hood){\r\n    if(hood.map.length<2){\r\n        return [];\r\n    }\r\n    switch (hood.type) {\r\n        case \"linear\":\r\n            for (var i = 0; i < hood.map.length; i++) {\r\n                if (id === hood.map[i]) {\r\n                    if (i === 0) //first one, return second as neighbor\r\n                        return [hood.map[1]];\r\n                    else if (i === hood.map.length - 1) //last one, return the second to the last as neighbor \r\n                        return [hood.map[hood.map.length - 2]];\r\n                    //Otherwise, return the neighboring two\r\n                    return [hood.map[i - 1], hood.map[i + 1]];\r\n                }\r\n            }\r\n            break;\r\n\r\n        case \"circular\":\r\n            for (var i = 0; i < hood.map.length; i++) {\r\n                if (id === hood.map[i]) {\r\n                    if (i === 0) //first one, return last and second as neighbor\r\n                        return [hood.map[1], hood.map[hood.map.length-1]];\r\n                    else if (i === hood.map.length - 1) //last one, return the second to the last and first as neighbor \r\n                        return [hood.map[hood.map.length - 2], hood.map[0]];\r\n                    //Otherwise, return the neighboring two\r\n                    return [hood.map[i - 1], hood.map[i + 1]];\r\n                }\r\n            }\r\n            break;\r\n\r\n        case \"irregular\":\r\n            return hood.map[id];\r\n    }\r\n    \r\n    \r\n}\r\n\r\n// Should use superagent to mock when we have time\r\nexport const getPanoCoordById = (id) => Promise.resolve({ data: { data: getDataFromJSONArray(mockedPanos,[\"coord\"], id) } })\r\n//export const getAllPanoIdAndCoord = () => Promise.resolve({ data: { data: getDataFromJSON(mockedPanos,[\"id\", \"coord\"]) } })\r\nexport const getAllPanoIdAndCoord = () => Promise.resolve({ data: { data: mockedPanos } })\r\nexport const getPanoAllAttrById = (id) => Promise.resolve({ data: { data: getDataFromJSONArray(mockedPanos,[], id) } })\r\nexport const getPanoFileNameById = (id) => Promise.resolve({ data: { data:  getDataFromJSONArray(mockedPanos,[\"filename\"], id) } })\r\nexport const getNeighborsById = (id, neighborhood) => Promise.resolve({ data: { data: getNeighbors(id, neighborhood) } })\r\n\r\nconst apis = {\r\n    //insertPano,\r\n    //getAllPanos,\r\n    //deletePanoById,\r\n    //getPanoById,\r\n    //updateCalibrationById,\r\n\r\n    getPanoFileNameById,\r\n    getPanoCoordById,\r\n    getAllPanoIdAndCoord,\r\n    getPanoAllAttrById,\r\n    getNeighborsById\r\n}\r\n\r\nexport default apis","import React, { Component, useRef } from \"react\";\r\nimport ReactDOM from \"react-dom\";\r\nimport { Map, GoogleApiWrapper, Marker } from \"google-maps-react\";\r\nimport { withRouter, RouteComponentProps } from \"react-router-dom\";\r\nimport styled from \"styled-components\";\r\n\r\nimport api from \"./api/index\";\r\n\r\n// I believe there is a bug of google-maps-react\r\n// as it does not respect the custom style object you pass\r\n// in. So we have to use important for now\r\n// TODO:\r\n// look for better map candidate\r\nconst StyledMap = styled(Map)`\r\n\twidth: 100%;\r\n\theight: 100%;\r\n\tposition: relative !important;\r\n`;\r\n\r\nconst Container = styled.div`\r\n\twidth: 100%;\r\n\theight: 100%;\r\n\r\n\t& > div {\r\n\t\twidth: 100%;\r\n\t\theight: 100%;\r\n\t}\r\n`;\r\n\r\nconst regions = {\r\n\t\"boston\":{\r\n\t\tlat:42.36, lng:-71.053\r\n\t},\r\n\t\"concord\":{\r\n\t\tlat: 42.45955, lng: -71.3525\r\n\t}\r\n}\r\n\r\nexport interface Coordinate {\r\n\tid: string | number;\r\n\tlat: number;\r\n\tlng: number;\r\n}\r\nexport interface MapContainerState {\r\n\tshowComp: boolean;\r\n\tcoords?: Coordinate[];\r\n}\r\n\r\nexport interface MapContainerProps extends RouteComponentProps<{ region?: string} > {}\r\n\r\nclass MapContainer extends Component<MapContainerProps, MapContainerState> {\r\n\tconstructor(props) {\r\n\t\tsuper(props);\r\n\t\tthis.state = {\r\n\t\t\tshowComp: false\r\n\t\t};\r\n\t}\r\n\r\n\tcomponentDidMount() {\r\n\t\tvar getAllPanoCoords = async () => {\r\n\t\t\tawait api.getAllPanoIdAndCoord().then(result => {\r\n\t\t\t\tvar coordArr = [];\r\n\t\t\t\tlet data = result.data.data;\r\n\t\t\t\tfor (var i = 0; i < data.length; i++) {\r\n\t\t\t\t\tcoordArr.push({\r\n\t\t\t\t\t\tid: data[i].id,\r\n\t\t\t\t\t\tlat: data[i].coord.lat,\r\n\t\t\t\t\t\tlng: data[i].coord.lng\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t\tthis.setState({\r\n\t\t\t\t\tcoords: coordArr,\r\n\t\t\t\t\tshowComp: true\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t};\r\n\t\tgetAllPanoCoords();\r\n\t}\r\n\r\n\tshowComponent(i) {\r\n\t\tif (i !== true && i !== false) return;\r\n\t\tthis.setState({ showComp: i });\r\n\t}\r\n\r\n\tbounds = new (this.props as any).google.maps.LatLngBounds();\r\n\r\n\tsetBounds() {\r\n\t\tfor (var i = 0; i < (this.state as any).coords.length; i++) {\r\n\t\t\tlet coord = (this.state as any).coords[i];\r\n\t\t\tthis.bounds.extend(\r\n\t\t\t\tnew (this.props as any).google.maps.LatLng({\r\n\t\t\t\t\tlat: coord.lat,\r\n\t\t\t\t\tlng: coord.lng\r\n\t\t\t\t})\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n\r\n\taddMarkers() {\r\n\t\tthis.setBounds();\r\n\t\t//let map = new Map(this.refs.map,);\r\n\t\t//(this.props as any).google.maps.fitBounds(this.bounds);\r\n\t\treturn (this.state as any).coords.map((coord, index) => {\r\n\t\t\treturn (\r\n\t\t\t\t<Marker\r\n\t\t\t\t\tlid={coord.id}\r\n\t\t\t\t\tposition={{\r\n\t\t\t\t\t\tlat: coord.lat,\r\n\t\t\t\t\t\tlng: coord.lng\r\n\t\t\t\t\t}}\r\n\t\t\t\t\tonClick={e => {\r\n\t\t\t\t\t\tthis.showComponent(false);\r\n\t\t\t\t\t\treturn this.gotoPano(e.lid);\r\n\t\t\t\t\t}}\r\n\t\t\t\t\tkey={coord.id}\r\n\t\t\t\t/>\r\n\t\t\t);\r\n\t\t});\r\n    }\r\n    \r\n\tgotoPano(id) {\r\n\t\t// @ts-ignore\r\n\t\tthis.props.history.push(`/viewPano/${id}`);\r\n\t}\r\n\r\n\trender() {\r\n\t\tconst { showComp } = this.state;\r\n\t\treturn showComp ? (\r\n\t\t\t<StyledMap\r\n\t\t\t\tref={(this.props as any).onMapMounted}\r\n\t\t\t\tgoogle={(this.props as any).google}\r\n\t\t\t\tzoom={18}\r\n\t\t\t\tcenter={regions[this.props.match.params.region]}\r\n\t\t\t\tinitialCenter={regions[this.props.match.params.region]}\r\n\t\t\t\tbounds={this.bounds}\r\n\t\t\t>\r\n\t\t\t\t{this.addMarkers()}\r\n\t\t\t</StyledMap>\r\n\t\t) : null;\r\n\t}\r\n}\r\n\r\nconst EnhancedMap = GoogleApiWrapper({\r\n\tapiKey: `${process.env.REACT_APP_GOOGLE_MAPS_API_KEY}`\r\n})(withRouter(MapContainer));\r\n\r\n// google-maps-react is making an higher-order-component\r\n// in a stupid way, as there is no way for us to change\r\n// the container tag (always div), and the container does not\r\n// accept className prop, which makes it hard for us to style\r\nexport default props => (\r\n\t<Container>\r\n\t\t<EnhancedMap {...props} />\r\n\t</Container>\r\n);\r\n","import React, { Component } from \"react\";\r\nimport { Map, GoogleApiWrapper, Marker } from \"google-maps-react\";\r\nimport { withRouter, RouteComponentProps } from \"react-router-dom\";\r\nimport styled from \"styled-components\";\r\nimport { observable } from \"mobx\";\r\nimport { observer } from \"mobx-react\";\r\n\r\nimport { PanoStore } from \"./pano\";\r\nimport api from \"./api/index\";\r\n\r\nconst StyledMap = styled(Map)`\r\n\twidth: 100% !important;\r\n\theight: 100% !important;\r\n\tposition: relative !important;\r\n`;\r\n\r\nconst Container = styled.div`\r\n\twidth: 100%;\r\n\theight: 100%;\r\n\r\n\t& > div {\r\n\t\twidth: 100%;\r\n\t\theight: 100%;\r\n\t}\r\n`;\r\n\r\nvar minimapElement;\r\nvar mapHandlerInit = () => {\r\n\tminimapElement = (document.getElementsByClassName('Minimap') as HTMLCollectionOf<HTMLElement>)[0];\r\n\t//console.log(minimapElement[0]);\r\n\tminimapElement.addEventListener(\"mouseover\", e => minimapZoomIn(e), false);\r\n\tminimapElement.addEventListener(\"mouseout\", e => minimapZoomOut(e), false);\r\n}\r\nfunction minimapZoomIn(e){\r\n\te.preventDefault();\r\n\tminimapElement.style.width = \"250px\";\r\n\tminimapElement.style.height = \"200px\";\r\n}\r\n\r\nfunction minimapZoomOut(e){\r\n\te.preventDefault();\r\n\tminimapElement.style.width = \"200px\";\r\n\tminimapElement.style.height = \"100px\";\r\n}\r\n\r\nexport interface Coordinate {\r\n\tid: string | number;\r\n\tlat: number;\r\n\tlng: number;\r\n}\r\nexport interface MapContainerState {\r\n\tshowComp: boolean;\r\n\tcoords?: Coordinate[];\r\n\tmapStore?: MapStore;\r\n}\r\n\r\ntype center = {\r\n\tlng: string,\r\n\tlat: string,\r\n\tbearing: string\r\n}\r\n\r\nexport interface MapContainerProps extends RouteComponentProps<{MapStore}> {}\r\n\r\nexport class MapStore {\r\n\t@observable lng:number;\r\n\t@observable lat:number;\r\n\t//@observable bearing:number;\r\n\t@observable id:string;\r\n\t@observable pmanOffsetY:number;\r\n\r\n\tconstructor(lat, lng, cameraY, id){\r\n\t\tthis.lng = lng;\r\n\t\tthis.lat = lat;\r\n\t\t//this.bearing = this.cameraYtoAbsRadian( cameraY );\r\n\t\tthis.id = id;\r\n\t\tthis.pmanOffsetY = this.setPegmanRotationOffsetYFromCameraY(cameraY);\r\n\t}\r\n\r\n\tupdateValues(lat, lng, cameraY, id){\r\n\t\tthis.lng = lng;\r\n\t\tthis.lat = lat;\r\n\t\t//this.bearing = this.cameraYtoAbsRadian( cameraY );\r\n\t\tthis.id = id;\r\n\t\tthis.pmanOffsetY = this.setPegmanRotationOffsetYFromCameraY(cameraY);\r\n\t}\r\n\r\n\tupdatePegmanOffset(cameraY){\r\n\t\tthis.pmanOffsetY = this.setPegmanRotationOffsetYFromCameraY(cameraY);\r\n\t}\r\n\r\n\tsetPegmanRotationOffsetYFromCameraY(cameraY){\r\n\t\tvar deg = Math.ceil(-cameraY*180/Math.PI);\r\n\t\tif(deg<0){\r\n\t\t\tdeg = 360+deg;\r\n\t\t}\r\n\t\treturn 9+Math.floor(deg/22.5)*60;\r\n\t}\r\n} \r\n\r\n\r\n@observer\r\nclass MapContainer extends Component<MapContainerProps, MapContainerState> {\r\n\t\r\n\tpanoStore:PanoStore;\r\n\tmStore:MapStore;\r\n\r\n\tconstructor(props) {\r\n\t\tsuper(props);\r\n\t\tthis.state = {\r\n\t\t\tshowComp: false,\r\n\t\t\tmapStore: (this.props as any).mapStore\r\n\t\t};\r\n\t\tthis.mStore = (this.props as any).mapStore;\r\n\t\tthis.panoStore = (this.props as any).panoStore;\r\n\t}\r\n\t\r\n\tcomponentDidMount() {\r\n\t\tvar getAllPanoCoords = async () => {\r\n\t\t\tawait api.getAllPanoIdAndCoord().then(result => {\r\n\t\t\t\tvar coordArr = [];\r\n\t\t\t\tlet data = result.data.data;\r\n\t\t\t\tfor (var i = 0; i < data.length; i++) {\r\n\t\t\t\t\tcoordArr.push({\r\n\t\t\t\t\t\tid: data[i].id,\r\n\t\t\t\t\t\tlat: data[i].coord.lat,\r\n\t\t\t\t\t\tlng: data[i].coord.lng\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t\tthis.setState({\r\n\t\t\t\t\tcoords: coordArr,\r\n\t\t\t\t\tshowComp: true\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t};\r\n\t\tgetAllPanoCoords();\r\n\t}\r\n\r\n\tshowComponent(i) {\r\n\t\tif (i !== true && i !== false) return;\r\n\t\tthis.setState({ showComp: i });\r\n\t}\r\n\r\n\tbounds = new (this.props as any).google.maps.LatLngBounds();\r\n\r\n\tsetBounds() {\r\n\t\tfor (var i = 0; i < (this.state as any).coords.length; i++) {\r\n\t\t\tlet coord = (this.state as any).coords[i];\r\n\t\t\tthis.bounds.extend(\r\n\t\t\t\tnew (this.props as any).google.maps.LatLng({\r\n\t\t\t\t\tlat: coord.lat,\r\n\t\t\t\t\tlng: coord.lng\r\n\t\t\t\t})\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n\r\n\tdotIcon = {\r\n\t\turl: require(`./assets/pano_inside-2-medium.png`),\r\n\t\tsize: new (this.props as any).google.maps.Size(11, 11),\r\n\t\torigin: new (this.props as any).google.maps.Point(0, 0),\r\n\t\tanchor: new (this.props as any).google.maps.Point(5.5, 5.5)\r\n\t};\r\n\r\n\t\r\n\r\n\tpman;\r\n\r\n\taddPegman() {\r\n\t\tvar origin = new (this.props as any).google.maps.Point(8, 9);\r\n\t\tif(this.mStore.pmanOffsetY){\r\n\t\t\torigin = new (this.props as any).google.maps.Point(8, this.mStore.pmanOffsetY);\r\n\t\t}\r\n\t\tvar pegIcon = {\r\n\t\t\turl: require(`./assets/rotating.png`),\r\n\t\t\tsize: new (this.props as any).google.maps.Size(44, 49),\r\n\t\t\torigin: origin,\r\n\t\t\tanchor: new (this.props as any).google.maps.Point(22, 34)\r\n\t\t};\r\n\t\tthis.pman = <Marker\r\n\t\t\tlid={this.mStore.id}\r\n\t\t\tposition={{\r\n\t\t\t\tlat: this.mStore.lat,\r\n\t\t\t\tlng: this.mStore.lng\r\n\t\t\t}}\r\n\t\t\ticon={pegIcon}\r\n\t\t\tkey={this.mStore.id}\r\n\t\t/>;\r\n\t\treturn this.pman;\r\n\t}\r\n\r\n\taddMarkers() {\r\n\t\tthis.setBounds();\r\n\t\t//let map = new Map(this.refs.map,);\r\n\t\t//(this.props as any).google.maps.fitBounds(this.bounds);\r\n\t\tvar icon;\r\n\t\tvar z = 0;\r\n\t\treturn (this.state as any).coords.map((coord, index) => {\r\n\t\t\tif ((this.state as any).coords[index].id === this.mStore.id) {\r\n\t\t\t\t\r\n\t\t\t}else{\r\n\t\t\t\ticon = this.dotIcon;\r\n\t\t\t\tz++;\r\n\t\t\t\treturn (\r\n\t\t\t\t\t<Marker\r\n\t\t\t\t\t\tlid={coord.id}\r\n\t\t\t\t\t\tposition={{\r\n\t\t\t\t\t\t\tlat: coord.lat,\r\n\t\t\t\t\t\t\tlng: coord.lng\r\n\t\t\t\t\t\t}}\r\n\t\t\t\t\t\tonClick={e => {\r\n\t\t\t\t\t\t\treturn this.gotoPano(e.lid);\r\n\t\t\t\t\t\t}}\r\n\t\t\t\t\t\ticon={icon}\r\n\t\t\t\t\t\tkey={coord.id}\r\n\t\t\t\t\t\tzIndex={z}\r\n\t\t\t\t\t/>\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t})\r\n\t}\r\n\r\n\trenderCompass(){\r\n\r\n\t}\r\n\t\r\n\r\n\tgotoPano(id) {\r\n\t\t// @ts-ignore\r\n\t\t//this.props.history.push(`/viewPano/${id}`);\r\n\t\t//console.log(\"Update id: \"+id);\r\n\t\tthis.panoStore.id = id;\r\n\t}\r\n\r\n\trender() {\r\n\t\tconst { showComp } = this.state;\r\n\t\treturn showComp ? (\r\n\t\t\t<>\r\n\t\t\t<StyledMap\r\n\t\t\t\tref={(this.props as any).onMapMounted}\r\n\t\t\t\tgoogle={(this.props as any).google}\r\n\t\t\t\tzoom={17}\r\n\t\t\t\tcenter={{ lat: this.mStore.lat, lng: this.mStore.lng }}\r\n\t\t\t\tinitialCenter={{ lat: this.mStore.lat, lng: this.mStore.lng }}\r\n\t\t\t\tbounds={this.bounds}\r\n\t\t\t\tonReady={mapHandlerInit}\r\n\t\t\t\tstreetViewControl={false}\r\n\t\t\t\tfullscreenControl={false}\r\n\t\t\t\tmapTypeControl={false}\r\n\t\t\t\trotateControl={false}\r\n\t\t\t>\r\n\t\t\t\t{this.addMarkers()}\r\n\t\t\t\t{this.addPegman()}\r\n\t\t\t</StyledMap>\r\n\t\t\t{this.renderCompass()}\r\n\t\t\t</>\r\n\t\t) : null;\r\n\t}\r\n}\r\n\r\nconst Minimap = GoogleApiWrapper({\r\n\tapiKey: `${process.env.REACT_APP_GOOGLE_MAPS_API_KEY}`\r\n})(withRouter(MapContainer));\r\n\r\nexport default props => (\r\n\t<Container>\r\n\t\t<Minimap {...props} />\r\n\t</Container>\r\n);\r\n","import * as geolib from 'geolib'\r\nimport api from './api/index'\r\n\r\nclass Location {\r\n    //Members\r\n    coord: {\r\n        lat: number,\r\n        lng: number\r\n    } = { lat: 0, lng: 0 }\r\n    calibration: number = 0.0;\r\n    id: string;\r\n    fname: string = \"\";\r\n    neighborhood: string = \"\";\r\n    neighborArr\r\n    cameraY\r\n\r\n    //Methods\r\n    constructor(id: string) {\r\n        this.id = id;\r\n    }\r\n\r\n    setAllAttr = async () => {\r\n        await api.getPanoAllAttrById(this.id).then(result => {\r\n            this.fname = result.data.data.filename;\r\n            this.coord.lat = result.data.data.coord.lat;\r\n            this.coord.lng = result.data.data.coord.lng;\r\n            this.calibration = result.data.data.calibration;\r\n            this.neighborhood = result.data.data.neighborhood;\r\n        })\r\n    }\r\n\r\n    getNeighborIds = async () => {\r\n        await api.getNeighborsById(this.id, this.neighborhood).then(result => {\r\n            this.neighborArr = result.data.data;\r\n        })\r\n    }\r\n\r\n    getDistanceTo(loc: Location){\r\n        return geolib.getDistance(this.coord,loc.coord);\r\n    }\r\n\r\n    getDistanceToNeighbors(neighbor: Location[]) {\r\n        return neighbor.map(this.getDistanceTo);\r\n    }\r\n\r\n    getBearingTo(loc: Location) {\r\n        return geolib.getRhumbLineBearing(this.coord, loc.coord);\r\n    }\r\n\r\n    getBearingToNeighbors(neighbor: Location[]) {\r\n        return neighbor.map(this.getBearingTo);\r\n    }\r\n\r\n    updateCalibration = async (camera) => {\r\n        const payload = {\r\n            \"calibration\": -camera.rotation.y\r\n        }\r\n        //await api.updateCalibrationById(this.id,payload).then(res=>{\r\n        alert(\"Update Calibration is disabled at this moment!\");\r\n        //})\r\n    }\r\n}\r\n\r\nexport { Location }\r\n","import * as THREE from \"three\"\r\n\r\nclass Cylinder{\r\n    //Members\r\n    mesh: THREE.Mesh;\r\n    material: THREE.MeshBasicMaterial;\r\n    geometry: THREE.CylinderBufferGeometry;\r\n    texture: THREE.Texture;\r\n    loader: THREE.TextureLoader;\r\n\r\n    constructor(){\r\n        this.geometry = new THREE.CylinderBufferGeometry(20, 20, 15, 100, 1, true);\r\n        this.texture = new THREE.Texture();\r\n        this.loader = new THREE.TextureLoader();\r\n        this.material = new THREE.MeshBasicMaterial();\r\n        this.mesh = new THREE.Mesh(this.geometry, this.material);\r\n    }\r\n    \r\n    LoadPanoTexture(fname:string, onComplete:Function){\r\n        this.texture = this.loader.load(process.env.PUBLIC_URL + 'resource/'+fname, undefined, undefined, err => {\r\n            console.error(err)\r\n        });\r\n    }\r\n}\r\n\r\nclass Arrow{\r\n    //Members\r\n    mesh: THREE.Mesh;\r\n    material: THREE.MeshBasicMaterial;\r\n    geometry;\r\n    id: string\r\n\r\n    constructor() {\r\n        this.geometry = new THREE.Geometry();\r\n        this.geometry.vertices.push(\r\n            new THREE.Vector3(0, 0, 0),  // 0\r\n            new THREE.Vector3(1.5, -2, 0),  // 1\r\n            new THREE.Vector3(1.5, -0.5, 0),  // 2\r\n            new THREE.Vector3(0, 1.5, 0),  // 3\r\n            new THREE.Vector3(-1.5, -0.5, 0),  // 4\r\n            new THREE.Vector3(-1.5, -2, 0),  // 5\r\n        );\r\n        this.geometry.faces.push(\r\n            new THREE.Face3(0, 1, 2),\r\n            new THREE.Face3(0, 2, 3),\r\n            new THREE.Face3(4, 0, 3),\r\n            new THREE.Face3(5, 0, 4),\r\n        );\r\n\r\n        this.material = new THREE.MeshBasicMaterial({ color: \"white\" })\r\n        this.mesh = new THREE.Mesh(this.geometry, this.material);\r\n    }\r\n    onClickHandler(){\r\n        \r\n    }\r\n\r\n}\r\n\r\nexport{Arrow, Cylinder}\r\n\r\n","import React from \"react\";\r\nimport styled from \"styled-components\";\r\n\r\nconst Rings = styled.div`\r\n\t&,\r\n\t&:after {\r\n\t\tborder-radius: 50%;\r\n\t\twidth: ${({ width = \"48\" }) => width}px;\r\n\t\theight: ${({ width = \"48\" }) => width}px;\r\n\t}\r\n\t& {\r\n\t\tmargin: 60px auto;\r\n\t\tfont-size: 10px;\r\n\t\tposition: relative;\r\n\t\ttext-indent: -9999em;\r\n\t\tborder-top: 1.1em solid rgba(0, 0, 0, 0.1);\r\n\t\tborder-right: 1.1em solid rgba(0, 0, 0, 0.1);\r\n\t\tborder-bottom: 1.1em solid rgba(0, 0, 0, 0.1);\r\n\t\tborder-left: 1.1em solid ${({ color = \"#ea6c2f\" }) => color};\r\n\t\t-webkit-transform: translateZ(0);\r\n\t\t-ms-transform: translateZ(0);\r\n\t\ttransform: translateZ(0);\r\n\t\t-webkit-animation: load8 1.1s infinite linear;\r\n\t\tanimation: load8 1.1s infinite linear;\r\n\t}\r\n\t@-webkit-keyframes load8 {\r\n\t\t0% {\r\n\t\t\t-webkit-transform: rotate(0deg);\r\n\t\t\ttransform: rotate(0deg);\r\n\t\t}\r\n\t\t100% {\r\n\t\t\t-webkit-transform: rotate(360deg);\r\n\t\t\ttransform: rotate(360deg);\r\n\t\t}\r\n\t}\r\n\t@keyframes load8 {\r\n\t\t0% {\r\n\t\t\t-webkit-transform: rotate(0deg);\r\n\t\t\ttransform: rotate(0deg);\r\n\t\t}\r\n\t\t100% {\r\n\t\t\t-webkit-transform: rotate(360deg);\r\n\t\t\ttransform: rotate(360deg);\r\n\t\t}\r\n\t}\r\n`;\r\n\r\nexport default Rings;\r\n","import React, { Component, useRef } from \"react\";\r\nimport * as THREE from \"three\";\r\nimport { Canvas, useThree, useRender } from \"react-three-fiber\";\r\nimport { withRouter, RouteComponentProps } from \"react-router-dom\";\r\n//import SVGLoader from \"three-svg-loader\";\r\nimport { disableBodyScroll } from 'body-scroll-lock';\r\n\r\nimport \"./style/pano.css\";\r\nimport Minimap, {MapStore} from \"./minimap\"\r\nimport { Location } from \"./geo\";\r\nimport { Arrow, Cylinder } from \"./shapes\";\r\nimport Spinner from \"./components/spinner\";\r\nimport { observable, reaction } from \"mobx\";\r\nimport { Vector3 } from \"three\";\r\n//import { observer } from \"mobx-react\";\r\n//import OrbitControls from 'three-orbitcontrols'\r\n\r\nconst TWEEN = require(\"@tweenjs/tween.js\");\r\n\r\ninterface PanoProps extends RouteComponentProps<{ id?: string, position? }> {\r\n\tlid: string;\r\n}\r\n\r\ntype PanoState = { isLoading: boolean };\r\ntype NeighborType = {\r\n\tlocation: Location;\r\n\tdistance: number;\r\n\tbearing: number;\r\n};\r\n\r\nclass Pano extends Component<PanoProps, PanoState> {\r\n\t//Members\r\n\tcurrLoc: Location;\r\n\tneighbors: Map<string, NeighborType>;\r\n\tmapStore = undefined;\r\n\tpanoStore = undefined;\r\n\tpanoIdChangeReaction;\r\n\r\n\tconstructor(props) {\r\n\t\tsuper(props);\r\n\t\tthis.state = {\r\n\t\t\tisLoading: true\r\n\t\t};\r\n\t\tthis.RenderPano = this.RenderPano.bind(this);\r\n\t}\r\n\t\r\n\tget panoId() {\r\n\t\t// @ts-ignore\r\n\t\treturn this.props.match.params.id || \"20190724143833\";\r\n\t}\r\n\r\n\tcomponentDidMount() {\r\n\t\tdisableBodyScroll(document.querySelector('#interface'));\r\n\t\tvar setCurrLocAndNeighbors = async () => {\r\n\t\t\t//setCurrLoc\r\n\t\t\tthis.currLoc = new Location(this.panoId);\r\n\t\t\tawait this.currLoc.setAllAttr().then(() => {\r\n\t\t\t\tthis.loadTexture();\r\n\t\t\t});\r\n\t\t\t//setNeighbors\r\n\t\t\tthis.neighbors = new Map();\r\n\t\t\tthis.setNeighbors();\r\n\t\t};\r\n\t\tsetCurrLocAndNeighbors();\r\n\t}\r\n\r\n\tasync setNeighbors() {//Only supports two neighbors for now\r\n        this.neighbors.clear();//Purge previous neighbors\r\n\t\tawait this.currLoc.getNeighborIds();\r\n\t\tlet nidArr = this.currLoc.neighborArr;\r\n\t\tif((nidArr as any).length===0){\r\n\t\t\tconsole.log(\"No neighbors discorvered...\");\r\n\t\t\treturn ;\r\n\t\t}\r\n\t\telse{\r\n\t\t\tfor(let nid of nidArr as any){\r\n\t\t\t\tlet nextLoc = new Location(nid);\r\n\t\t\t\tawait nextLoc.setAllAttr().then(() => {\r\n\t\t\t\t\tthis.addNeighbor(nextLoc);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\taddNeighbor(n: Location) {\r\n\t\tthis.neighbors.set(n.id, {\r\n\t\t\tlocation: n,\r\n\t\t\tdistance: this.currLoc.getDistanceTo(n),\r\n\t\t\tbearing: this.currLoc.getBearingTo(n)\r\n\t\t});\r\n\t}\r\n\r\n\t//THREEjs objects\r\n\tcylindergeometry = new THREE.CylinderBufferGeometry(20, 20, 15, 100, 1, true);\r\n\tcylindermaterial = undefined;\r\n\tcylindermesh = undefined;\r\n\ttexture = undefined;\r\n\tloader = new THREE.TextureLoader();\r\n\tlines = [];\r\n\t\r\n    tempcylindergeometry = new THREE.CylinderBufferGeometry(21, 21, 15, 100, 1, true);\r\n\ttempcylindermaterial = undefined;\r\n\ttempcylindermesh = undefined;\r\n\tthreeCamera = undefined;\r\n\tthreeScene = undefined;\r\n\r\n\tcone0:THREE.Mesh;\r\n\tcone1:THREE.Mesh;\r\n\tcone2:THREE.Mesh;\r\n\r\n\tpinSphereGeometry = new THREE.SphereGeometry(0.5,16,16);\r\n\tpinNeedleGeometry = new THREE.CylinderGeometry(0.075, 0.025, 3, 10, 1, false);\r\n\tpin0:THREE.Group;\r\n\tpin1:THREE.Group;\r\n\tpin2:THREE.Group;\r\n\r\n\t//Neighbors\r\n\tn0:NeighborType;\r\n\tn1:NeighborType;\r\n\tn2:NeighborType;\r\n\r\n\tmouseSelectedArrowMesh:THREE.Mesh;\r\n\r\n\t\r\n\r\n\tloadTexture() {\r\n\t\tthis.texture = this.loader.load(\r\n\t\t\trequire(`./assets/viewPano/resource/${this.currLoc.fname}`),\r\n\t\t\t() => {\r\n\t\t\t\tthis.mapStore = new MapStore(this.currLoc.coord.lat, this.currLoc.coord.lng, 0.0, this.currLoc.id);\r\n\t\t\t\tthis.panoStore = new PanoStore(this.currLoc.id);\r\n\t\t\t\tthis.panoIdChangeReaction = reaction(\r\n\t\t\t\t\t() => this.panoStore.id,\r\n\t\t\t\t\t(id, reaction) => {\r\n\t\t\t\t\t\t//console.log(this.panoStore);\r\n\t\t\t\t\t\tthis.teleportToScene(id);\r\n\t\t\t\t\t\t//reaction.dispose();\r\n\t\t\t\t\t}\r\n\t\t\t\t);\r\n\t\t\t\tthis.setState({ isLoading: false });\r\n\t\t\t},\r\n\t\t\tundefined,\r\n\t\t\terr => {\r\n\t\t\t\tconsole.error(err);\r\n\t\t\t}\r\n\t\t);\r\n\r\n\t\tthis.cylindermaterial = new THREE.MeshBasicMaterial({\r\n\t\t\tmap: this.texture,\r\n\t\t\tside: THREE.DoubleSide\r\n\t\t});\r\n\t\tthis.cylindermesh = new THREE.Mesh(\r\n\t\t\tthis.cylindergeometry,\r\n\t\t\tthis.cylindermaterial\r\n\t\t);\r\n\t\tthis.cylindergeometry.scale(-1, 1, 1);\r\n\t\t//this.cylindermesh.position.y = 0\r\n        this.cylindermesh.rotation.y = this.currLoc.calibration;\r\n\t}\r\n\t\r\n\r\n\t/*\r\n\tInitNeighborPins() {\r\n\t\tconsole.log(this.lines);\r\n\t\tif (this.lines.length !== 0) {\r\n\t\t\tthis.lines = [];\r\n\t\t}\r\n\t\tthis.neighbors.forEach((loc, id) => {\r\n\t\t\tlet bearing = loc.bearing;\r\n\t\t\tlet line = new THREE.LineBasicMaterial({ color: \"blue\" });\r\n\t\t\tlet geometry = new THREE.Geometry();\r\n\t\t\tgeometry.vertices.push(new THREE.Vector3(0, -5, 0));\r\n\t\t\tgeometry.vertices.push(\r\n\t\t\t\tnew THREE.Vector3(\r\n\t\t\t\t\t20 * Math.sin((bearing * Math.PI) / 180),\r\n\t\t\t\t\t-5,\r\n\t\t\t\t\t-20 * Math.cos((bearing * Math.PI) / 180)\r\n\t\t\t\t)\r\n\t\t\t);\r\n\t\t\tthis.lines.push(new THREE.Line(geometry, line));\r\n\t\t});\r\n\t}*/\r\n\r\n\tCameraLookNorth(camera) {\r\n\t\tvar rotBegin = {\r\n\t\t\tat: camera.rotation.y\r\n\t\t};\r\n\t\tvar rotEnd = {\r\n\t\t\tat: 0\r\n\t\t};\r\n\t\tvar tweenRot = new TWEEN.Tween(rotBegin)\r\n\t\t\t.to(rotEnd, 750)\r\n\t\t\t.easing(TWEEN.Easing.Quadratic.InOut);\r\n\t\ttweenRot.onUpdate(function() {\r\n\t\t\tcamera.rotation.y = rotBegin.at;\r\n\t\t});\r\n\t\ttweenRot.onComplete(() => {\r\n\t\t\tcamera.rotation.y = 0;\r\n\t\t\tthis.mapStore.updatePegmanOffset(0.0);\r\n\t\t});\r\n\t\ttweenRot.start();\r\n\t}\r\n\r\n\tteleportToScene = async (id) => {\r\n\t\t//console.log(\"Teleporting to: \"+id);\r\n\t\tthis.currLoc = new Location(id);\r\n\t\tawait this.currLoc.setAllAttr().then(()=>{\r\n\t\t\tthis.texture = this.loader.load(\r\n\t\t\t\trequire(`./assets/viewPano/resource/${this.currLoc.fname}`),\r\n\t\t\t\t() => {//onComplete\r\n\t\t\t\t\tthis.tempcylindermaterial = new THREE.MeshBasicMaterial({\r\n\t\t\t\t\t\tmap: this.texture,\r\n\t\t\t\t\t\tside: THREE.DoubleSide\r\n\t\t\t\t\t});\r\n\t\t\t\t\tthis.tempcylindermesh = new THREE.Mesh(\r\n\t\t\t\t\t\tthis.tempcylindergeometry,\r\n\t\t\t\t\t\tthis.tempcylindermaterial\r\n\t\t\t\t\t);\r\n\t\t\t\t\tthis.tempcylindergeometry.scale(-1, 1, 1);\r\n\t\t\t\t\tthis.tempcylindermesh.rotation.y = this.currLoc.calibration;\r\n\t\t\t\t\tthis.threeScene.add(this.tempcylindermesh);\r\n\t\t\t\t\tthis.animateTeleportationTextureFade();\r\n\t\t\t\t\tlet {coord, cameraY, id} = this.currLoc;\r\n\t\t\t\t\tthis.mapStore.updateValues(coord.lat, coord.lng, cameraY, id);\r\n\t\t\t\t},\r\n\t\t\t\tundefined,\r\n\t\t\t\terr => {\r\n\t\t\t\t\tconsole.error(err);\r\n\t\t\t\t}\r\n\t\t\t);\r\n\t\t});\r\n\t}\r\n\r\n\tanimateTeleportationTextureFade = () => {\r\n\t\tvar fadeBegin = {\r\n\t\t\tat: this.cylindermaterial.opacity\r\n\t\t};\r\n\t\tvar fadeEnd = {\r\n\t\t\tat: 0.1\r\n\t\t};\r\n\t\tvar crossfade = new TWEEN.Tween(fadeBegin)\r\n\t\t\t.to(fadeEnd, 500)\r\n\t\t\t.easing(TWEEN.Easing.Quadratic.InOut);\r\n\t\tcrossfade.onUpdate(() => {\r\n\t\t\t//console.log(this.cylindermaterial);\r\n\t\t\tthis.cylindermaterial.opacity = fadeBegin.at;\r\n\t\t});\r\n\t\tcrossfade.onComplete( async () => {\r\n\t\t\t//reset camera zoom and pos\r\n\t\t\tthis.threeCamera.rotation.y = 0;\r\n\t\t\t(this.threeCamera as any).fov = 40;\r\n\t\t\t(this.threeCamera as any).updateProjectionMatrix();\r\n\t\t\t//When animations are completed, textures are swapped\r\n\t\t\t\r\n\t\t\tthis.cylindermaterial.map = this.texture;\r\n\t\t\tthis.cylindermesh.rotation.y = this.currLoc.calibration;\r\n\t\t\tthis.cylindermaterial.transparent = false;\r\n\t\t\tthis.cylindermaterial.opacity = 1.0;\r\n\r\n\t\t\tthis.threeScene.remove(this.tempcylindermesh);\r\n\t\t\tthis.tempcylindermesh.geometry.dispose();\r\n\t\t\tthis.tempcylindermesh.material.dispose();\r\n\t\t\tthis.tempcylindermesh = undefined;\r\n\t\t\tthis.tempcylindergeometry.scale(-1,1,1);\r\n\t\t\tawait this.setNeighbors().then(this.RenderArrows);\r\n\t\t});\r\n\t\tthis.cylindermaterial.transparent = true;\r\n\t\tcrossfade.start();\r\n\t}\r\n\r\n\tRenderArrows = () => {\r\n\t\tvar iter = this.neighbors.keys();\r\n\t\t//iter.next();\r\n\t\tthis.n0 = this.neighbors.get(iter.next().value);\r\n\t\tconsole.log(this.currLoc.id);\r\n\t\tlet arrowSpacing = 7.5;\r\n\t\t//position\r\n\t\tthis.cone0.position.z = - arrowSpacing * Math.cos(this.n0.bearing * Math.PI / 180);\r\n\t\tthis.cone0.position.x = arrowSpacing * Math.sin(this.n0.bearing * Math.PI / 180);\r\n\t\t//rotation\r\n\t\tthis.cone0.rotation.x = -1.5708;\r\n\t\tthis.cone0.rotation.z = (-this.n0.bearing) * Math.PI / 180;\r\n\t\tthis.cone1.visible = false;\r\n\t\tthis.cone2.visible = false;\r\n\t\t//this.cone0.geometry.computeBoundingSphere();\r\n\t\t\r\n\t\tif(this.neighbors.size>1){\r\n\t\t\tthis.n1 = this.neighbors.get(iter.next().value);\r\n\t\t\tthis.cone1.visible = true;\r\n\t\t\t//position\r\n\t\t\tthis.cone1.position.z = -arrowSpacing * Math.cos(this.n1.bearing * Math.PI / 180);\r\n\t\t\tthis.cone1.position.x = arrowSpacing * Math.sin(this.n1.bearing * Math.PI / 180);\r\n\t\t\t//rotation\r\n\t\t\tthis.cone1.rotation.x = -1.5708;\r\n\t\t\tthis.cone1.rotation.z = (-this.n1.bearing) * Math.PI / 180;\r\n\t\t\t//console.log(this.cone1.rotation.z);\r\n\t\t\t//this.cone1.geometry.computeBoundingSphere();\r\n\t\t\t//console.log(this.cone1.localToWorld(this.cone1.geometry.boundingSphere.center));\r\n\t\t}\r\n\t\tif(this.neighbors.size===3){\r\n\t\t\tthis.n2 = this.neighbors.get(iter.next().value);\r\n\t\t\tthis.cone2.visible = true;\r\n\t\t\t//position\r\n\t\t\tthis.cone2.position.z = -arrowSpacing * Math.cos(this.n2.bearing * Math.PI / 180);\r\n\t\t\tthis.cone2.position.x = arrowSpacing * Math.sin(this.n2.bearing * Math.PI / 180);\r\n\t\t\t//rotation\r\n\t\t\tthis.cone2.rotation.x = -1.5708;\r\n\t\t\tthis.cone2.rotation.z = (-this.n2.bearing) * Math.PI / 180;\r\n\t\t\t//this.cone2.geometry.computeBoundingSphere();\r\n\t\t\t//console.log(this.cone2.rotation.z);\r\n\t\t}\r\n\t}\r\n\r\n\tRenderPano() {\r\n\t\tvar { gl, camera, scene, canvas, raycaster } = useThree();\r\n\t\t//var canvas = gl.domElement;  // for react-three-fiber v3.x\r\n\t\tthis.threeCamera = camera;\r\n\t\tthis.threeScene = scene;\r\n\t\t\r\n\t\t(camera as any).fov = 40;\r\n\t\t//gl.setSize(window.innerWidth, window.innerHeight);\r\n\t\tgl.setSize(canvas.clientWidth, canvas.clientHeight);\r\n\t\t\r\n\t\tcamera.position.set(0, 0, 0.01);\r\n\t\tcamera.lookAt(0, 0, 0);\r\n\r\n\t\tlet cone = new Arrow();\r\n\t\tvar conemesh = useRef();\r\n\t\tvar conemesh1 = useRef();\r\n\t\tvar conemesh2 = useRef();\r\n\t\t//var mousedir = useRef();\r\n\t\tvar compassPlate = useRef();\r\n\r\n\t\tthis.cone0 = conemesh.current as any;\r\n\t\tthis.cone1 = conemesh1.current as any;\r\n\t\tthis.cone2 = conemesh2.current as any;\r\n\r\n\t\t\r\n\r\n\t\tvar mouse = { x: 0, y: 0 };\r\n\t\tlet arrow = new Arrow();\r\n\t\tlet mouseplateG = useRef();\r\n\t\tvar showMousePlate = true;\r\n\t\tvar isAnimating = false;\r\n\t\tlet isDraggin = false;\r\n\t\r\n\t\tvar rcObjects = [];\r\n\r\n\t\tvar planegeo = new THREE.PlaneGeometry(40, 40);\r\n\t\tvar planemat = new THREE.MeshBasicMaterial({ color: \"grey\", side: THREE.DoubleSide, opacity:0.0, transparent:true });\r\n\t\tvar rcplane = new THREE.Mesh(planegeo, planemat); //not a remotely-controlled plane, but a mathematical plane that involves in raycast\r\n\t\trcplane.rotation.set(-1.5708, 0, 0);\r\n\t\trcplane.position.set(0,-1,0);\r\n\t\tscene.add(rcplane);\r\n\t\tif (conemesh.current && conemesh1.current && conemesh2.current && compassPlate.current) {\r\n\t\t\trcObjects.push(conemesh.current);\r\n\t\t\trcObjects.push(conemesh1.current);\r\n\t\t\trcObjects.push(conemesh2.current);\r\n\t\t\trcObjects.push(compassPlate.current);\r\n\t\t\trcObjects.push(rcplane);\r\n\t\t\t//rcObjects.push(compassGroup.current);\r\n\t\t}\r\n\r\n\t\tvar bsphere = useRef();\r\n\t\tif(bsphere.current){\r\n\t\t\tthis.cone0.geometry.computeBoundingSphere();\r\n\t\t\tlet center1 = this.cone0.geometry.boundingSphere.center;\r\n\t\t\tlet v1 = new Vector3(center1.x,center1.y,center1.z);\r\n\t\t\t//@ts-ignore\r\n\t\t\tconeGroup.current.localToWorld(v1);\r\n\t\t}\r\n\r\n\t\tvar distanceToArrowInWorldCoord = (mesh) => {\r\n\t\t\t(mouseplateG.current as any).children[1].geometry.computeBoundingSphere();\r\n\t\t\tlet center0 = (mouseplateG.current as any).children[1].geometry.boundingSphere.center;\r\n\t\t\tlet v0 = new Vector3(center0.x,center0.y,center0.z);\r\n\t\t\t(mouseplateG.current as any).localToWorld(v0);\r\n\r\n\t\t\tmesh.geometry.computeBoundingSphere();\r\n\t\t\tlet center1 = mesh.geometry.boundingSphere.center;\r\n\t\t\tlet v1 = new Vector3(center1.x,center1.y,center1.z);\r\n\t\t\tmesh.localToWorld(v1);\r\n\t\t\t\r\n\t\t\treturn v0.distanceTo(v1);\r\n\t\t}\r\n\r\n\t\tvar getClosestArrowAndAdjustDirection = () => {\r\n\t\t\tif(!mouseplateG.current)\r\n\t\t\t\treturn;\r\n\t\t\tlet arr = [this.cone0, this.cone1, this.cone2];\r\n\t\t\tlet dist = new Map<number, THREE.Mesh>();\r\n\t\t\tfor(let cone of arr){\r\n\t\t\t\tif(!cone.visible){\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t\tdist.set( distanceToArrowInWorldCoord(cone), cone );\r\n\t\t\t}\r\n\t\t\tlet min = Math.min(...dist.keys());\r\n\t\t\t(mouseplateG.current as any).rotation.z = dist.get(min).rotation.z;\r\n\t\t\tthis.mouseSelectedArrowMesh = dist.get(min);\r\n\t\t}\r\n\r\n\t\tvar navigateWithMouse = () => {\r\n\t\t\tlet nArr = [this.n0, this.n1, this.n2];\r\n\t\t\tlet id = nArr[this.mouseSelectedArrowMesh.userData.neighbor].location.id;\r\n\t\t\ttransitionToScene(id);\r\n\t\t}\r\n\r\n\t\tvar onMouseMove2 = ( event ) => {\r\n\t\t\tif(mouseplateG.current){\r\n\t\t\t\tevent.preventDefault();\r\n\t\t\t\tmouse.x = (event.clientX / window.innerWidth) * 2 - 1;\r\n\t\t\t\tmouse.y = - (event.clientY / window.innerHeight) * 2 + 1;\r\n\t\t\t\traycaster.setFromCamera(mouse, camera);\r\n\t\t\t\tvar intersects = raycaster.intersectObjects(rcObjects);\r\n\t\t\t\tif (intersects.length > 0) {\r\n\t\t\t\t\tvar intersect = intersects[0];\r\n\t\t\t\t\t//console.log( intersects[ 0 ]);\r\n\t\t\t\t\tif( intersects.length === 1){//intersect.object===rcplane){\r\n\t\t\t\t\t\t//console.log(compassGroup.current);\r\n\t\t\t\t\t\t(mouseplateG.current as any).visible = true;\r\n\t\t\t\t\t\t(mouseplateG.current as any).position.copy(intersect.point).add(new THREE.Vector3(0, 0.01, 0));\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\t(mouseplateG.current as any).visible = false;\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Mouse drag rotation controls\r\n\t\tvar mouseDown = false,\r\n\t\t\tmouseX = 0,\r\n\t\t\tmouseY = 0;\r\n\r\n\t\tfunction onMouseMove(evt) {\r\n\t\t\tif (mouseDown) {\r\n\t\t\t\tevt.preventDefault();\r\n\t\t\t\tvar deltaX = evt.clientX - mouseX,\r\n\t\t\t\t\tdeltaY = evt.clientY - mouseY;\r\n\t\t\t\tmouseX = evt.clientX;\r\n\t\t\t\tmouseY = evt.clientY;\r\n\r\n\t\t\t\trotateScene(deltaX);\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tfunction onMouseDown(evt) {\r\n\t\t\tevt.preventDefault();\r\n\t\t\tmouseDown = true;\r\n\t\t\tmouseX = evt.clientX;\r\n\t\t\tmouseY = evt.clientY;\r\n\t\t}\r\n\r\n\t\tfunction onMouseUp(evt) {\r\n\t\t\tevt.preventDefault();\r\n\t\t\tmouseDown = false;\r\n\t\t\tisDraggin = false;\r\n\t\t}\r\n\r\n\t\t//Touch rotation control\r\n\t\tvar startX = 0;\r\n\r\n\t\tfunction onTouchStart(event) {\r\n\t\t\tstartX = (event.targetTouches[0].pageX);\r\n\t\t}\r\n\r\n\t\tfunction onTouchMove(event) {\r\n\t\t\tvar deltaX = (event.targetTouches[0].pageX - startX);\r\n\t\t\tstartX = (event.targetTouches[0].pageX);\r\n\t\t\trotateScene(deltaX);\r\n\t\t}\r\n\r\n\t\t//Mouse wheel rotation control\r\n\t\tfunction onScroll(event) {\r\n\t\t\tif(event.path[0]===canvas){\r\n\t\t\t\tvar deltaY = event.wheelDeltaY / 3;\r\n\t\t\t\trotateScene(deltaY);\r\n\t\t\t}\r\n        }\r\n        \r\n\t\tvar rotateScene = (deltaX) => {\r\n\t\t\tisDraggin = true;\r\n\t\t\tcamera.rotation.y += deltaX / 1000;\r\n\t\t\tcamera.rotation.y %= 2 * Math.PI;\r\n\t\t\tthis.mapStore.updatePegmanOffset(camera.rotation.y);\r\n\t\t}\r\n\t\t\r\n\t\tfunction onWindowResize(){\r\n\t\t\tgl.setSize(canvas.clientWidth, canvas.clientHeight);\r\n\t\t\t(camera as any).aspect = canvas.clientWidth / canvas.clientHeight;\r\n\t\t\t(camera as any).updateProjectionMatrix();\r\n\t\t}\r\n\r\n\r\n\t\twindow.addEventListener('mousemove', onMouseMove2, false);\r\n\t\tcanvas.addEventListener(\"mousemove\", e => onMouseMove(e), false);\r\n\t\tcanvas.addEventListener(\"mousedown\", e => onMouseDown(e), false);\r\n\t\tcanvas.addEventListener(\"mouseup\", e => onMouseUp(e), false);\r\n\t\tcanvas.addEventListener(\"mousewheel\", e => onScroll(e),false);\r\n\t\tcanvas.addEventListener(\"touchmove\", e => onTouchMove(e), false);\r\n\t\tcanvas.addEventListener(\"touchstart\", e => onTouchStart(e), false);\r\n\t\twindow.addEventListener( 'resize', onWindowResize, false );\r\n\r\n\t\tvar animateTransition = id => {\r\n\t\t\t(mouseplateG.current as any).visible = false;\r\n\t\t\tisAnimating = true;\r\n            //Set up parameters for TWEEN animations\r\n\t\t\tconst depth = 13;\r\n\t\t\tconst resFov = 65;\r\n\t\t\tconst camAt = (this.neighbors.get(id).bearing * Math.PI) / 180;\r\n\t\t\tvar endAt = (-this.neighbors.get(id).bearing * Math.PI) / 180;\r\n\t\t\tif (camera.rotation.y > 0) {\r\n\t\t\t\tendAt = 2 * Math.PI - (this.neighbors.get(id).bearing * Math.PI) / 180;\r\n\t\t\t}\r\n\t\t\tif(camera.rotation.y-endAt >= Math.PI && camera.rotation.y-endAt<2*Math.PI){\r\n\t\t\t\tendAt += 2 * Math.PI; \r\n\t\t\t}else if( camera.rotation.y-endAt <= -Math.PI && camera.rotation.y-endAt< -2*Math.PI){\r\n\t\t\t\tendAt = - 2 * Math.PI + endAt;\r\n\t\t\t}\r\n\t\t\tvar rotBegin = {\r\n\t\t\t\tat: (camera as any).rotation.y\r\n\t\t\t};\r\n\t\t\tvar rotEnd = {\r\n\t\t\t\tat: endAt\r\n\t\t\t};\r\n\t\t\tvar tweenRot = new TWEEN.Tween(rotBegin)\r\n\t\t\t\t.to(rotEnd, 500)\r\n\t\t\t\t.easing(TWEEN.Easing.Quadratic.InOut);\r\n\t\t\ttweenRot.onUpdate(function() {\r\n\t\t\t\t(camera as any).rotation.y = rotBegin.at;\r\n\t\t\t});\r\n\t\t\ttweenRot.onComplete(() => {\r\n\t\t\t\tcamera.rotation.y = (-this.neighbors.get(id).bearing * Math.PI) / 180;\r\n\t\t\t\tthis.mapStore.updatePegmanOffset(camera.rotation.y);\r\n\t\t\t});\r\n\r\n\t\t\tvar zoom = {\r\n\t\t\t\tzVal: (camera as any).position.z,\r\n\t\t\t\txVal: (camera as any).position.x,\r\n                fovValue: (camera as any).fov,\r\n                opacity: this.cylindermaterial.opacity\r\n\t\t\t};\r\n\t\t\tvar zoomEnd = {\r\n\t\t\t\tzVal: -depth * Math.cos(camAt),\r\n\t\t\t\txVal: depth * Math.sin(camAt),\r\n                fovValue: resFov,\r\n                opacity: 0.1\r\n\t\t\t};\r\n\t\t\tvar tweenZoom = new TWEEN.Tween(zoom).to(zoomEnd, 500);\r\n\r\n\t\t\ttweenZoom.onUpdate(() => {\r\n\t\t\t\t(camera as any).position.z = zoom.zVal;\r\n\t\t\t\t(camera as any).position.x = zoom.xVal;\r\n\t\t\t\t(camera as any).fov = zoom.fovValue;\r\n                (camera as any).updateProjectionMatrix();\r\n                this.cylindermaterial.opacity = zoom.opacity;\r\n\t\t\t});\r\n\t\t\ttweenZoom.onComplete(async () => {\r\n                //reset camera zoom and pos\r\n                camera.position.set(0,0,0);\r\n\t\t\t\t(camera as any).fov = 40;\r\n                (camera as any).updateProjectionMatrix();\r\n                //When animations are completed, textures are swapped\r\n                \r\n                this.cylindermaterial.map = this.texture;\r\n                this.cylindermesh.rotation.y = this.currLoc.calibration;\r\n                this.cylindermaterial.transparent = false;\r\n                this.cylindermaterial.opacity = 1.0;\r\n\r\n                scene.remove(this.tempcylindermesh);\r\n                this.tempcylindermesh.geometry.dispose();\r\n                this.tempcylindermesh.material.dispose();\r\n                this.tempcylindermesh = undefined;\r\n\t\t\t\tthis.tempcylindergeometry.scale(-1,1,1);\r\n\t\t\t\tisAnimating = false;\r\n\t\t\t\t(mouseplateG.current as any).visible = true;\r\n\t\t\t\tawait this.setNeighbors().then(this.RenderArrows);//.then(()=>{this.InitNeighborPins()});\r\n\t\t\t});\r\n            tweenRot.chain(tweenZoom);\r\n            this.cylindermaterial.transparent = true;\r\n            \r\n\t\t\ttweenRot.start();\r\n\t\t};\r\n        \r\n        scene.add(this.cylindermesh);\r\n\t\t//RenderCompass();\r\n\r\n\t\tvar transitionToScene = async (pid) => {\r\n\t\t\tthis.currLoc = this.neighbors.get(pid).location;\r\n\t\t\t//await this.currLoc.setAllAttr();\r\n\t\t\tthis.texture = this.loader.load(\r\n\t\t\t\trequire(`./assets/viewPano/resource/${this.currLoc.fname}`),\r\n\t\t\t\t() => {//onComplete\r\n                    this.tempcylindermaterial = new THREE.MeshBasicMaterial({\r\n                        map: this.texture,\r\n                        side: THREE.DoubleSide\r\n                    });\r\n                    this.tempcylindermesh = new THREE.Mesh(\r\n                        this.tempcylindergeometry,\r\n                        this.tempcylindermaterial\r\n                    );\r\n                    this.tempcylindergeometry.scale(-1, 1, 1);\r\n                    this.tempcylindermesh.rotation.y = this.currLoc.calibration;\r\n                    scene.add(this.tempcylindermesh);\r\n\t\t\t\t\tanimateTransition(pid);\r\n\t\t\t\t\tlet {coord, cameraY, id} = this.currLoc;\r\n\t\t\t\t\tthis.mapStore.updateValues(coord.lat, coord.lng, cameraY, id);\r\n\t\t\t\t},\r\n\t\t\t\tundefined,\r\n\t\t\t\terr => {\r\n\t\t\t\t\tconsole.error(err);\r\n\t\t\t\t}\r\n\t\t\t);\r\n\t\t};\r\n\t\t\r\n        if(conemesh.current&&conemesh1.current&&conemesh2.current){\r\n\t\t\tthis.RenderArrows();\r\n        }\r\n\t\tvar coneGroup = useRef();\r\n\t\tvar compassGroup = useRef();\r\n\t\tvar triGeo = useRef();\r\n\t\tlet triGeoArr = [new THREE.Vector3(0, 1, 0), new THREE.Vector3(-0.6, -1, 0), new THREE.Vector3(0, -0.5, 0), new THREE.Vector3(0.6, -1, 0)];\r\n\t\tif (triGeo.current){\r\n\t\t\t(triGeo.current as any).vertices = triGeoArr;\r\n\t\t\t(triGeo.current as any).faces.push( new THREE.Face3( 0, 1, 2 ) );\r\n\t\t\t(triGeo.current as any).faces.push( new THREE.Face3( 0, 2, 3 ) );\r\n\t\t\t(triGeo.current as any).computeFaceNormals();\r\n\t\t\t(triGeo.current as any).scale(0.3, 0.3, 0.3);\r\n\t\t}\r\n\t\tfunction setChildrenOpacity(group, opc){\r\n\t\t\tfor(let child of group){\r\n\t\t\t\tchild.material.opacity = opc;\r\n\t\t\t}\r\n        }\r\n        \r\n        var testMesh = useRef();\r\n        if(testMesh.current){\r\n            (testMesh.current as any).geometry.scale(2,2,2);\r\n\t\t}\r\n\r\n\t\tuseRender(() => {\r\n\t\t\tTWEEN.update();\r\n\t\t\t(coneGroup.current as any).position.set(\r\n\t\t\t\t-3 * Math.sin(camera.rotation.y),\r\n\t\t\t\t-0.9,\r\n\t\t\t\t-3 * Math.cos(camera.rotation.y)\r\n\t\t\t);\r\n\t\t\t(compassGroup.current as any).position.set(\r\n\t\t\t\t-3 * Math.sin(camera.rotation.y-0.4),\r\n\t\t\t\t-0.8,\r\n\t\t\t\t-3 * Math.cos(camera.rotation.y-0.4)\r\n\t\t\t);\r\n\t\t\t(compassGroup.current as any).rotation.y=camera.rotation.y;\r\n\t\t\t(compassGroup.current as any).rotation.z=-camera.rotation.y;\r\n\t\t\t\r\n\t\t\tgetClosestArrowAndAdjustDirection();\r\n\t\t\t\r\n\r\n\t\t});\r\n\r\n\t\treturn (\r\n\t\t\t<>\r\n\t\t\t\t<group /*group of arrows */\r\n\r\n\t\t\t\t\tref={coneGroup}\r\n\t\t\t\t\tscale={[0.2, 0.2, 0.2]}\r\n\t\t\t\t>\r\n\t\t\t\t\t<mesh //First Arrow\r\n\t\t\t\t\t\tuserData={{neighbor:0}}\r\n\t\t\t\t\t\tonClick={() => {\r\n\t\t\t\t\t\t\ttransitionToScene(this.n0.location.id); /*this.currLoc.updateCalibration(camera)*/\r\n\t\t\t\t\t\t}}\r\n\t\t\t\t\t\tonPointerOver={e => {(e.object as any).material.opacity=0.9;}}\r\n\t\t\t\t\t\tonPointerOut={e => {(e.object as any).material.opacity=0.65;}}\r\n\t\t\t\t\t\tref={conemesh}\r\n\t\t\t\t\t\tgeometry={cone.geometry}\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t<meshBasicMaterial attach=\"material\" color=\"white\" opacity={0.5} transparent={true}/>\r\n\t\t\t\t\t</mesh>\r\n\t\t\t\t\t<mesh //Second Arrow\r\n\t\t\t\t\t\tuserData={{neighbor:1}}\r\n\t\t\t\t\t\tonClick={() => {\r\n\t\t\t\t\t\t\ttransitionToScene(this.n1.location.id);\r\n\t\t\t\t\t\t}}\r\n\t\t\t\t\t\tonPointerOver={e => {(e.object as any).material.opacity=0.9;}}\r\n\t\t\t\t\t\tonPointerOut={e => {(e.object as any).material.opacity=0.65;}}\r\n                        ref={conemesh1}\r\n                        geometry={cone.geometry}\r\n                    >\r\n                        <meshBasicMaterial attach=\"material\" color=\"white\" opacity={0.5} transparent={true}/>\r\n                    </mesh>\r\n\t\t\t\t\t<mesh //Third Arrow\r\n\t\t\t\t\t\tuserData={{neighbor:2}}\r\n\t\t\t\t\t\tonClick={() => {\r\n\t\t\t\t\t\t\ttransitionToScene(this.n2.location.id);\r\n\t\t\t\t\t\t}}\r\n\t\t\t\t\t\tonPointerOver={e => {(e.object as any).material.opacity=0.9;}}\r\n\t\t\t\t\t\tonPointerOut={e => { (e.object as any).material.opacity = 0.65; }}\r\n\t\t\t\t\t\tref={conemesh2}\r\n\t\t\t\t\t\tgeometry={cone.geometry}\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t<meshBasicMaterial attach=\"material\" color=\"white\" opacity={0.5} transparent={true} />\r\n\t\t\t\t\t</mesh>\r\n\t\t\t\t\t\r\n\t\t\t\t\t\r\n\t\t\t\t</group>\r\n\t\t\t\t<group\r\n\t\t\t\t\tonPointerOver={e => {setChildrenOpacity(e.object.children, 0.8);}}\r\n\t\t\t\t\tonPointerOut={e => {setChildrenOpacity(e.object.children, 0.5);}}\r\n\t\t\t\t\tref={compassGroup}\r\n\t\t\t\t\tposition={[0,0,-3]}\r\n\t\t\t\t\tscale={[0.3, 0.3, 0.3]}\r\n\t\t\t\t>\r\n\t\t\t\t\t<mesh //Compass Plate \r\n\t\t\t\t\t\tonClick={() => this.CameraLookNorth(camera)}\r\n\t\t\t\t\t\tgeometry={new THREE.CircleGeometry(0.4, 100, 0)}\r\n\t\t\t\t\t\tref={compassPlate}\t\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t<meshBasicMaterial attach=\"material\" color=\"white\" opacity={0.5} transparent={true} />\r\n\t\t\t\t\t</mesh>\r\n\t\t\t\t\t<mesh //Compass North Arrow \r\n\t\t\t\t\t\tposition={[0, 0.03, 0.01]}\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t<geometry\r\n\t\t\t\t\t\t\tattach=\"geometry\"\r\n\t\t\t\t\t\t\tref={triGeo}\r\n\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t<meshBasicMaterial attach=\"material\" color=\"red\" opacity={0.5} transparent={true} />\r\n\t\t\t\t\t</mesh>\r\n\t\t\t\t</group>\r\n\r\n\t\t\t\t<group\r\n\t\t\t\t\tref={mouseplateG}\r\n\t\t\t\t\trotation={[-1.5708, 0, 0]}\r\n\t\t\t\t\tonPointerUp={()=>{if(!isDraggin){ navigateWithMouse(); }}}\r\n\t\t\t\t>\r\n\t\t\t\t\t<mesh\r\n\t\t\t\t\t\tgeometry={arrow.geometry}\r\n\t\t\t\t\t\tposition={[0, 0.05, 0.001]}\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tscale={[0.2, 0.12, 0.2]}\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t<meshBasicMaterial attach=\"material\" color=\"grey\" opacity={0.7} transparent={true} />\r\n\t\t\t\t\t</mesh>\r\n\t\t\t\t\t<mesh\r\n\t\t\t\t\t\tgeometry={new THREE.CircleGeometry(0.4, 100, 0)}\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t<meshBasicMaterial attach=\"material\" color=\"white\" opacity={0.7} transparent={true} />\r\n\t\t\t\t\t</mesh>\r\n\t\t\t\t</group>\r\n\r\n\t\t\t\t{/*<group\r\n\t\t\t\t\tref={pinGroup}\r\n\t\t\t\t\tposition={[-7, 0.1, -7]}\r\n\t\t\t\t\tscale={[0.5,0.5,0.5]}\r\n\t\t\t\t>\r\n\t\t\t\t\t<group\r\n\t\t\t\t\t\tref={ping0}\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t<mesh\r\n\t\t\t\t\t\t\tgeometry={this.pinNeedleGeometry}\r\n\t\t\t\t\t\t\tposition={[0, -2, 0]}\r\n\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t<meshBasicMaterial attach=\"material\" color=\"white\" opacity={0.75} transparent={true} />\r\n\t\t\t\t\t\t</mesh>\r\n\t\t\t\t\t\t<mesh\r\n\t\t\t\t\t\t\tgeometry={this.pinSphereGeometry}\r\n\t\t\t\t\t\t\tposition={[0, 0, 0]}\r\n\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t<meshBasicMaterial attach=\"material\" color=\"red\" opacity={0.75} transparent={true} />\r\n\t\t\t\t\t\t</mesh>\r\n\t\t\t\t\t</group>\r\n\t\t\t\t</group>*/}\r\n\t\t\t</>\r\n\t\t);\r\n\t}\r\n\t//TODO: change the pano window render size\r\n\trender() {\r\n\t\tconst { isLoading } = this.state;\r\n\t\t\r\n\r\n\t\treturn isLoading ? (\r\n\t\t\t<div className={\"spinner-container\"}>\r\n\t\t\t\t<Spinner width={100} height={100} />\r\n\t\t\t</div>\r\n\t\t) : (\r\n\t\t\t<div className=\"Pano-container\">\r\n\t\t\t\t<div className=\"Pano-canvas\">\r\n\t\t\t\t\t<Canvas>\r\n\t\t\t\t\t\t<this.RenderPano />\r\n\t\t\t\t\t</Canvas>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div className=\"Minimap\">\r\n\t\t\t\t\t<Minimap mapStore={this.mapStore} panoStore={this.panoStore}/>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t);\r\n\t}\r\n}\r\n\r\nexport class PanoStore{\r\n\t@observable id:string\r\n\r\n\tconstructor(id){\r\n\t\tthis.id=id;\r\n\t}\r\n\tpublic updateId(id){\r\n\t\tthis.id=id;\r\n\t}\r\n}\r\n\r\nexport default withRouter(Pano);\r\n\r\n","import React, { Component } from \"react\";\r\nimport ReactDOM from \"react-dom\";\r\nimport {\r\n\tHashRouter as Router,\r\n\tRoute,\r\n\tSwitch,\r\n\tNavLink,\r\n\tRedirect\r\n} from \"react-router-dom\";\r\n\r\nimport { Container, Header, Content } from \"./components/layout\";\r\nimport GMap from \"./maps\";\r\nimport Pano from \"./pano\";\r\nimport \"./style/App.css\";\r\n\r\nconst routes = [\r\n\t{\r\n\t\tpath: \"/maps/boston\",\r\n\t\ttitle: \"Boston\"\r\n\t},\r\n\t{\r\n\t\tpath: \"/maps/concord\",\r\n\t\ttitle: \"Concord\"\r\n\t}\r\n];\r\n\r\nexport class Interface extends Component {\r\n\tconstructor(props){\r\n        super(props)\r\n        this.state = {\r\n\t\t\trenderPano: true\r\n\t\t};\r\n        this.panoUnmount = this.panoUnmount.bind(this);\r\n    }\r\n    panoUnmount(){\r\n        this.setState({renderPano: false});\r\n    }\r\n\r\n\trender() {\r\n\t\treturn (\r\n\t\t\t<Router>\r\n\t\t\t\t<Container>\r\n\t\t\t\t\t<Header>\r\n\t\t\t\t\t\t{routes.map(r => (\r\n\t\t\t\t\t\t\t<NavLink\r\n\t\t\t\t\t\t\t\tto={r.path}\r\n\t\t\t\t\t\t\t\tkey={r.path}\r\n\t\t\t\t\t\t\t\tactiveClassName=\"ir-nav-item__active\"\r\n\t\t\t\t\t\t\t\tclassName=\"ir-nav-item\"\r\n\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t{r.title}\r\n\t\t\t\t\t\t\t</NavLink>\r\n\t\t\t\t\t\t))}\r\n\t\t\t\t\t</Header>\r\n\t\t\t\t\t<Content>\r\n\t\t\t\t\t\t<Switch>\r\n\t\t\t\t\t\t\t<Route path=\"/maps/:region\" render={(props) => <GMap {...props}/> } />\r\n\t\t\t\t\t\t\t<Route exact={true} path=\"/viewPano/:id\" render={(props) => (this.state as any).renderPano ? <Pano {...props}/> : null } />\r\n\t\t\t\t\t\t\t<Route path=\"/viewPano\" component={Pano} />\r\n\t\t\t\t\t\t\t<Redirect exact from=\"/\" to=\"maps/concord\" />\r\n\t\t\t\t\t\t</Switch>\r\n\t\t\t\t\t</Content>\r\n\t\t\t\t</Container>\r\n\t\t\t</Router>\r\n\t\t);\r\n\t}\r\n};\r\n","import React, { Component } from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport './style/index.css';\r\nimport * as App from './App';\r\n\r\nReactDOM.render(<App.Interface />, document.getElementById('interface'));\r\n\r\n"],"sourceRoot":""}